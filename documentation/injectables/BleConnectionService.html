<!doctype html>
<html class="no-js" lang="">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>mi-band-3-companion documentation</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="icon" type="image/x-icon" href="../images/favicon.ico">
	   <link rel="stylesheet" href="../styles/style.css">
        <link rel="stylesheet" href="../styles/dark.css">
    </head>
    <body>

        <div class="navbar navbar-default navbar-fixed-top visible-xs">
            <a href="../" class="navbar-brand">mi-band-3-companion documentation</a>
            <button type="button" class="btn btn-default btn-menu ion-ios-menu" id="btn-menu"></button>
        </div>

        <div class="xs-menu menu" id="mobile-menu">
                <div id="book-search-input" role="search"><input type="text" placeholder="Type to search"></div>            <compodoc-menu></compodoc-menu>
        </div>

        <div class="container-fluid main">
           <div class="row main">
               <div class="hidden-xs menu">
                   <compodoc-menu mode="normal"></compodoc-menu>
               </div>
               <!-- START CONTENT -->
               <div class="content injectable">
                   <div class="content-data">








<ol class="breadcrumb">
  <li>Injectables</li>
  <li >BleConnectionService</li>
</ol>

<ul class="nav nav-tabs" role="tablist">
        <li class="active">
            <a href="#info" role="tab" id="info-tab" data-toggle="tab" data-link="info">Info</a>
        </li>
        <li >
            <a href="#source" role="tab" id="source-tab" data-toggle="tab" data-link="source">Source</a>
        </li>
</ul>

<div class="tab-content">
    <div class="tab-pane fade active in" id="c-info">
        <p class="comment">
            <h3>File</h3>
        </p>
        <p class="comment">
            <code>src/app/services/ble/connection/ble-connection.service.ts</code>
        </p>



            <p class="comment">
                <h3>Extends</h3>
            </p>
            <p class="comment">
                        <code><a href="../injectables/BleBaseService.html" target="_self" >BleBaseService</a></code>
            </p>


            <section>
    <h3 id="index">Index</h3>
    <table class="table table-sm table-bordered index-table">
        <tbody>
                <tr>
                    <td class="col-md-4">
                        <h6><b>Properties</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#blStatusSubject" >blStatusSubject</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#connectionInfo" >connectionInfo</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#connectionInfoSubject" >connectionInfoSubject</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#deviceSettingsSubject" >deviceSettingsSubject</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Readonly</span>
                                <a href="#logHelper" >logHelper</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#scanInfoSubject" >scanInfoSubject</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#sentEncryptionKeyAgain" >sentEncryptionKeyAgain</a>
                            </li>
                            <li>
                                    <span class="modifier">Protected</span>
                                    <span class="modifier">Readonly</span>
                                <a href="#miBand3" >miBand3</a>
                            </li>
                        </ul>
                    </td>
                </tr>

                <tr>
                    <td class="col-md-4">
                        <h6><b>Methods</b></h6>
                    </td>
                </tr>
                <tr>
                    <td class="col-md-4">
                        <ul class="index-list">
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#authenticateMiBand" >authenticateMiBand</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#blAndPermissionChecks" >blAndPermissionChecks</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#connect" >connect</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#createTimeoutForEnableBL" >createTimeoutForEnableBL</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#disconnectAndClose" >disconnectAndClose</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#enableBL" >enableBL</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#getConnectObserver" >getConnectObserver</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#getEncryptionKey" >getEncryptionKey</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                <a href="#initializeBL" >initializeBL</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#isBLEnabled" >isBLEnabled</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#isConnected" >isConnected</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#scanForDevices" >scanForDevices</a>
                            </li>
                            <li>
                                    <span class="modifier">Private</span>
                                    <span class="modifier">Async</span>
                                <a href="#sendEncryptionKey" >sendEncryptionKey</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                    <span class="modifier">Async</span>
                                <a href="#wasConnected" >wasConnected</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#bytesFromInt" >bytesFromInt</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#bytesToInt" >bytesToInt</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#dateTimeFromBytes" >dateTimeFromBytes</a>
                            </li>
                            <li>
                                    <span class="modifier">Public</span>
                                <a href="#dateTimeToBytes" >dateTimeToBytes</a>
                            </li>
                            <li>
                                    <span class="modifier">Protected</span>
                                    <span class="modifier">Async</span>
                                <a href="#read" >read</a>
                            </li>
                            <li>
                                    <span class="modifier">Protected</span>
                                <a href="#subscribe" >subscribe</a>
                            </li>
                            <li>
                                    <span class="modifier">Protected</span>
                                    <span class="modifier">Async</span>
                                <a href="#unsubscribe" >unsubscribe</a>
                            </li>
                            <li>
                                    <span class="modifier">Protected</span>
                                    <span class="modifier">Async</span>
                                <a href="#write" >write</a>
                            </li>
                        </ul>
                    </td>
                </tr>





        </tbody>
    </table>
</section>

            <section>
    <h3 id="constructor">Constructor</h3>
        <table class="table table-sm table-bordered">
            <tbody>
                <tr>
                    <td class="col-md-4">
                                <span class="modifier">Public</span>
                        <code>constructor(ble: BluetoothLE, platform: Platform, authService: <a href="../injectables/FirebaseAuthService.html" target="_self">FirebaseAuthService</a>, permissionService: <a href="../injectables/PermissionService.html" target="_self">PermissionService</a>)</code>
                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="33" class="link-to-prism">src/app/services/ble/connection/ble-connection.service.ts:33</a></div>
                            </td>
                        </tr>

                <tr>
                    <td class="col-md-4">
                            <div>
                                    <b>Parameters :</b>
                                    <table class="params">
                                        <thead>
                                            <tr>
                                                <td>Name</td>
                                                    <td>Type</td>
                                                <td>Optional</td>
                                            </tr>
                                        </thead>
                                        <tbody>
                                                <tr>
                                                        <td>ble</td>
                                                  
                                                        <td>
                                                                    <code>BluetoothLE</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>platform</td>
                                                  
                                                        <td>
                                                                    <code>Platform</code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>authService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/FirebaseAuthService.html" target="_self" >FirebaseAuthService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                                <tr>
                                                        <td>permissionService</td>
                                                  
                                                        <td>
                                                                        <code><a href="../injectables/PermissionService.html" target="_self" >PermissionService</a></code>
                                                        </td>
                                                  
                                                    <td>
                                                            No
                                                    </td>
                                                    
                                                </tr>
                                        </tbody>
                                    </table>
                            </div>
                    </td>
                </tr>
            </tbody>
        </table>
</section>

            <section>
    
    <h3 id="methods">
        Methods
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="authenticateMiBand"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span ><b>authenticateMiBand</b></span>
                        <a href="#authenticateMiBand"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>authenticateMiBand(device: <a href="../interfaces/IDevice.html" target="_self">IDevice</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="331"
                            class="link-to-prism">src/app/services/ble/connection/ble-connection.service.ts:331</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>device</td>
                                    <td>
                                                <code><a href="../interfaces/IDevice.html" target="_self" >IDevice</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="blAndPermissionChecks"></a>
                    <span class="name">
                        <span class="modifier">Public</span>
                        <span class="modifier">Async</span>
                        <span ><b>blAndPermissionChecks</b></span>
                        <a href="#blAndPermissionChecks"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>blAndPermissionChecks()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="161"
                            class="link-to-prism">src/app/services/ble/connection/ble-connection.service.ts:161</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="connect"></a>
                    <span class="name">
                        <span class="modifier">Public</span>
                        <span class="modifier">Async</span>
                        <span ><b>connect</b></span>
                        <a href="#connect"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>connect(device: <a href="../interfaces/IDevice.html" target="_self">IDevice</a>, autoConnect: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank">boolean</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="236"
                            class="link-to-prism">src/app/services/ble/connection/ble-connection.service.ts:236</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Default value</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>device</td>
                                    <td>
                                                <code><a href="../interfaces/IDevice.html" target="_self" >IDevice</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                    </td>

                                </tr>
                                <tr>
                                    <td>autoConnect</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>false</code>
                                    </td>

                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="createTimeoutForEnableBL"></a>
                    <span class="name">
                        <span class="modifier">Public</span>
                        <span ><b>createTimeoutForEnableBL</b></span>
                        <a href="#createTimeoutForEnableBL"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>createTimeoutForEnableBL(ms: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="144"
                            class="link-to-prism">src/app/services/ble/connection/ble-connection.service.ts:144</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>ms</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="disconnectAndClose"></a>
                    <span class="name">
                        <span class="modifier">Public</span>
                        <span class="modifier">Async</span>
                        <span ><b>disconnectAndClose</b></span>
                        <a href="#disconnectAndClose"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>disconnectAndClose(deviceData: <a href="../interfaces/IDevice.html" target="_self">string | IDevice</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="318"
                            class="link-to-prism">src/app/services/ble/connection/ble-connection.service.ts:318</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>deviceData</td>
                                    <td>
                                                <code><a href="../interfaces/IDevice.html" target="_self" >string | IDevice</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="enableBL"></a>
                    <span class="name">
                        <span class="modifier">Public</span>
                        <span class="modifier">Async</span>
                        <span ><b>enableBL</b></span>
                        <a href="#enableBL"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>enableBL(maxWaitTime: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="121"
                            class="link-to-prism">src/app/services/ble/connection/ble-connection.service.ts:121</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Default value</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>maxWaitTime</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>5000</code>
                                    </td>

                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;boolean&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getConnectObserver"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span ><b>getConnectObserver</b></span>
                        <a href="#getConnectObserver"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getConnectObserver()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="284"
                            class="link-to-prism">src/app/services/ble/connection/ble-connection.service.ts:284</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../classes/Device.html" target="_self" >Partial&lt;Observer&lt;DeviceInfo&gt;&gt;</a></code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="getEncryptionKey"></a>
                    <span class="name">
                        <span class="modifier">Public</span>
                        <span ><b>getEncryptionKey</b></span>
                        <a href="#getEncryptionKey"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>getEncryptionKey()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="453"
                            class="link-to-prism">src/app/services/ble/connection/ble-connection.service.ts:453</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Returns : </b>    <code>Buffer</code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="initializeBL"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span ><b>initializeBL</b></span>
                        <a href="#initializeBL"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>initializeBL(request, statusReceiver, restoreKey: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="72"
                            class="link-to-prism">src/app/services/ble/connection/ble-connection.service.ts:72</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Default value</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>request</td>
                                    <td>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>false</code>
                                    </td>

                                </tr>
                                <tr>
                                    <td>statusReceiver</td>
                                    <td>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>true</code>
                                    </td>

                                </tr>
                                <tr>
                                    <td>restoreKey</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>&#x27;miband3companion&#x27;</code>
                                    </td>

                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="isBLEnabled"></a>
                    <span class="name">
                        <span class="modifier">Public</span>
                        <span class="modifier">Async</span>
                        <span ><b>isBLEnabled</b></span>
                        <a href="#isBLEnabled"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>isBLEnabled()</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="152"
                            class="link-to-prism">src/app/services/ble/connection/ble-connection.service.ts:152</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;boolean&gt;</code>

                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="isConnected"></a>
                    <span class="name">
                        <span class="modifier">Public</span>
                        <span class="modifier">Async</span>
                        <span ><b>isConnected</b></span>
                        <a href="#isConnected"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>isConnected(deviceData: <a href="../interfaces/IDevice.html" target="_self">string | IDevice</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="98"
                            class="link-to-prism">src/app/services/ble/connection/ble-connection.service.ts:98</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>deviceData</td>
                                    <td>
                                                <code><a href="../interfaces/IDevice.html" target="_self" >string | IDevice</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;boolean&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="scanForDevices"></a>
                    <span class="name">
                        <span class="modifier">Public</span>
                        <span class="modifier">Async</span>
                        <span ><b>scanForDevices</b></span>
                        <a href="#scanForDevices"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>scanForDevices(scanTime: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="175"
                            class="link-to-prism">src/app/services/ble/connection/ble-connection.service.ts:175</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Default value</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>scanTime</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>1000</code>
                                    </td>

                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;void&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="sendEncryptionKey"></a>
                    <span class="name">
                        <span class="modifier">Private</span>
                        <span class="modifier">Async</span>
                        <span ><b>sendEncryptionKey</b></span>
                        <a href="#sendEncryptionKey"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>sendEncryptionKey(deviceData: <a href="../interfaces/IDevice.html" target="_self">string | IDevice</a>, service: <a href="../classes/Service.html" target="_self">string | Service</a>, characteristic: <a href="../classes/Characteristic.html" target="_self">string | Characteristic</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="439"
                            class="link-to-prism">src/app/services/ble/connection/ble-connection.service.ts:439</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>deviceData</td>
                                    <td>
                                                <code><a href="../interfaces/IDevice.html" target="_self" >string | IDevice</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>service</td>
                                    <td>
                                                <code><a href="../classes/Service.html" target="_self" >string | Service</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>characteristic</td>
                                    <td>
                                                <code><a href="../classes/Characteristic.html" target="_self" >string | Characteristic</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;OperationResult&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="wasConnected"></a>
                    <span class="name">
                        <span class="modifier">Public</span>
                        <span class="modifier">Async</span>
                        <span ><b>wasConnected</b></span>
                        <a href="#wasConnected"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>wasConnected(deviceData: <a href="../interfaces/IDevice.html" target="_self">string | IDevice</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Defined in <a href="" data-line="112"
                            class="link-to-prism">src/app/services/ble/connection/ble-connection.service.ts:112</a></div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>deviceData</td>
                                    <td>
                                                <code><a href="../interfaces/IDevice.html" target="_self" >string | IDevice</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;boolean&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="bytesFromInt"></a>
                    <span class="name">
                        <span class="modifier">Public</span>
                        <span ><b>bytesFromInt</b></span>
                        <a href="#bytesFromInt"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>bytesFromInt(num: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>, size?: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Inherited from         <code><a href="../injectables/BleBaseService.html" target="_self" >BleBaseService</a></code>
</div>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <div class="io-line">Defined in         <code><a href="../injectables/BleBaseService.html#source" target="_self" >BleBaseService:111</a></code>
</div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>num</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>size</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        Yes
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Uint8Array</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="bytesToInt"></a>
                    <span class="name">
                        <span class="modifier">Public</span>
                        <span ><b>bytesToInt</b></span>
                        <a href="#bytesToInt"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>bytesToInt(bytes: Uint8Array)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Inherited from         <code><a href="../injectables/BleBaseService.html" target="_self" >BleBaseService</a></code>
</div>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <div class="io-line">Defined in         <code><a href="../injectables/BleBaseService.html#source" target="_self" >BleBaseService:100</a></code>
</div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>bytes</td>
                                    <td>
                                            <code>Uint8Array</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="dateTimeFromBytes"></a>
                    <span class="name">
                        <span class="modifier">Public</span>
                        <span ><b>dateTimeFromBytes</b></span>
                        <a href="#dateTimeFromBytes"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>dateTimeFromBytes(bytes: Uint8Array, startIndex: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank">number</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Inherited from         <code><a href="../injectables/BleBaseService.html" target="_self" >BleBaseService</a></code>
</div>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <div class="io-line">Defined in         <code><a href="../injectables/BleBaseService.html#source" target="_self" >BleBaseService:134</a></code>
</div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Default value</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>bytes</td>
                                    <td>
                                            <code>Uint8Array</code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                    </td>

                                </tr>
                                <tr>
                                    <td>startIndex</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/number" target="_blank" >number</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>0</code>
                                    </td>

                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="../classes/FireTimestamp.html" target="_self" >FireTimestamp | undefined</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="dateTimeToBytes"></a>
                    <span class="name">
                        <span class="modifier">Public</span>
                        <span ><b>dateTimeToBytes</b></span>
                        <a href="#dateTimeToBytes"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>dateTimeToBytes(dateTime: <a href="../interfaces/IFireTimestamp.html" target="_self">Date | IFireTimestamp</a>, options?: literal type)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Inherited from         <code><a href="../injectables/BleBaseService.html" target="_self" >BleBaseService</a></code>
</div>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <div class="io-line">Defined in         <code><a href="../injectables/BleBaseService.html#source" target="_self" >BleBaseService:153</a></code>
</div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                    <td>Default value</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>dateTime</td>
                                    <td>
                                                <code><a href="../interfaces/IFireTimestamp.html" target="_self" >Date | IFireTimestamp</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>

                                    <td>
                                        <code>new Date()</code>
                                    </td>

                                </tr>
                                <tr>
                                    <td>options</td>
                                    <td>
                                            <code>literal type</code>
                                    </td>

                                    <td>
                                        Yes
                                    </td>

                                    <td>
                                    </td>

                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Uint8Array</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="read"></a>
                    <span class="name">
                        <span class="modifier">Protected</span>
                        <span class="modifier">Async</span>
                        <span ><b>read</b></span>
                        <a href="#read"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>read(deviceData: <a href="../interfaces/IDevice.html" target="_self">string | IDevice</a>, service: <a href="../classes/Service.html" target="_self">string | Service</a>, characteristic: <a href="../classes/Characteristic.html" target="_self">string | Characteristic</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Inherited from         <code><a href="../injectables/BleBaseService.html" target="_self" >BleBaseService</a></code>
</div>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <div class="io-line">Defined in         <code><a href="../injectables/BleBaseService.html#source" target="_self" >BleBaseService:48</a></code>
</div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>deviceData</td>
                                    <td>
                                                <code><a href="../interfaces/IDevice.html" target="_self" >string | IDevice</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>service</td>
                                    <td>
                                                <code><a href="../classes/Service.html" target="_self" >string | Service</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>characteristic</td>
                                    <td>
                                                <code><a href="../classes/Characteristic.html" target="_self" >string | Characteristic</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;OperationResult&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="subscribe"></a>
                    <span class="name">
                        <span class="modifier">Protected</span>
                        <span ><b>subscribe</b></span>
                        <a href="#subscribe"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>subscribe(deviceData: <a href="../interfaces/IDevice.html" target="_self">string | IDevice</a>, service: <a href="../classes/Service.html" target="_self">string | Service</a>, characteristic: <a href="../classes/Characteristic.html" target="_self">string | Characteristic</a>, observer: Partial<Observer<OperationResult>>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Inherited from         <code><a href="../injectables/BleBaseService.html" target="_self" >BleBaseService</a></code>
</div>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <div class="io-line">Defined in         <code><a href="../injectables/BleBaseService.html#source" target="_self" >BleBaseService:64</a></code>
</div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>deviceData</td>
                                    <td>
                                                <code><a href="../interfaces/IDevice.html" target="_self" >string | IDevice</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>service</td>
                                    <td>
                                                <code><a href="../classes/Service.html" target="_self" >string | Service</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>characteristic</td>
                                    <td>
                                                <code><a href="../classes/Characteristic.html" target="_self" >string | Characteristic</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>observer</td>
                                    <td>
                                            <code>Partial&lt;Observer&lt;OperationResult&gt;&gt;</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>        <code><a href="https://www.typescriptlang.org/docs/handbook/basic-types.html" target="_blank" >void</a></code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="unsubscribe"></a>
                    <span class="name">
                        <span class="modifier">Protected</span>
                        <span class="modifier">Async</span>
                        <span ><b>unsubscribe</b></span>
                        <a href="#unsubscribe"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>unsubscribe(device: <a href="../interfaces/IDevice.html" target="_self">string | IDevice</a>, service: <a href="../classes/Service.html" target="_self">string | Service</a>, characteristic: <a href="../classes/Characteristic.html" target="_self">string | Characteristic</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Inherited from         <code><a href="../injectables/BleBaseService.html" target="_self" >BleBaseService</a></code>
</div>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <div class="io-line">Defined in         <code><a href="../injectables/BleBaseService.html#source" target="_self" >BleBaseService:84</a></code>
</div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>device</td>
                                    <td>
                                                <code><a href="../interfaces/IDevice.html" target="_self" >string | IDevice</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>service</td>
                                    <td>
                                                <code><a href="../classes/Service.html" target="_self" >string | Service</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>characteristic</td>
                                    <td>
                                                <code><a href="../classes/Characteristic.html" target="_self" >string | Characteristic</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;UnsubscribeResult&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="write"></a>
                    <span class="name">
                        <span class="modifier">Protected</span>
                        <span class="modifier">Async</span>
                        <span ><b>write</b></span>
                        <a href="#write"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                    <span class="modifier-icon icon ion-ios-reset"></span>
                    <code>write(deviceData: <a href="../interfaces/IDevice.html" target="_self">string | IDevice</a>, service: <a href="../classes/Service.html" target="_self">string | Service</a>, characteristic: <a href="../classes/Characteristic.html" target="_self">string | Characteristic</a>, value: Buffer | Uint8Array, type?: <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank">string</a>)</code>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">
                    <div class="io-line">Inherited from         <code><a href="../injectables/BleBaseService.html" target="_self" >BleBaseService</a></code>
</div>
                </td>
            </tr>
            <tr>
                <td class="col-md-4">
                        <div class="io-line">Defined in         <code><a href="../injectables/BleBaseService.html#source" target="_self" >BleBaseService:24</a></code>
</div>
                </td>
            </tr>


            <tr>
                <td class="col-md-4">

                    <div class="io-description">
                        <b>Parameters :</b>
                        
                        <table class="params">
                            <thead>
                                <tr>
                                    <td>Name</td>
                                    <td>Type</td>
                                    <td>Optional</td>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>deviceData</td>
                                    <td>
                                                <code><a href="../interfaces/IDevice.html" target="_self" >string | IDevice</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>service</td>
                                    <td>
                                                <code><a href="../classes/Service.html" target="_self" >string | Service</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>characteristic</td>
                                    <td>
                                                <code><a href="../classes/Characteristic.html" target="_self" >string | Characteristic</a></code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>value</td>
                                    <td>
                                            <code>Buffer | Uint8Array</code>
                                    </td>

                                    <td>
                                        No
                                    </td>


                                </tr>
                                <tr>
                                    <td>type</td>
                                    <td>
                                                <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/string" target="_blank" >string</a></code>
                                    </td>

                                    <td>
                                        Yes
                                    </td>


                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div>
                    </div>
                    <div class="io-description">
                        <b>Returns : </b>    <code>Promise&lt;OperationResult&gt;</code>

                    </div>
                    <div class="io-description">
                        
                    </div>
                </td>
            </tr>
        </tbody>
    </table>
</section>
            <section>
    
    <h3 id="inputs">
        Properties
    </h3>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="blStatusSubject"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>blStatusSubject</b></span>
                        <a href="#blStatusSubject"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>    <code>Subject&lt;string&gt;</code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="30" class="link-to-prism">src/app/services/ble/connection/ble-connection.service.ts:30</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="connectionInfo"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>connectionInfo</b></span>
                        <a href="#connectionInfo"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="../classes/ConnectionInfo.html" target="_self" >ConnectionInfo</a></code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="28" class="link-to-prism">src/app/services/ble/connection/ble-connection.service.ts:28</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="connectionInfoSubject"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>connectionInfoSubject</b></span>
                        <a href="#connectionInfoSubject"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="../classes/ConnectionInfo.html" target="_self" >Subject&lt;ConnectionInfo&gt;</a></code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="31" class="link-to-prism">src/app/services/ble/connection/ble-connection.service.ts:31</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="deviceSettingsSubject"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>deviceSettingsSubject</b></span>
                        <a href="#deviceSettingsSubject"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="../classes/Device.html" target="_self" >BehaviorSubject&lt;Device&gt;</a></code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="33" class="link-to-prism">src/app/services/ble/connection/ble-connection.service.ts:33</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="logHelper"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                            <span class="modifier">Readonly</span>
                        <span ><b>logHelper</b></span>
                        <a href="#logHelper"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="../classes/LogHelper.html" target="_self" >LogHelper</a></code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="27" class="link-to-prism">src/app/services/ble/connection/ble-connection.service.ts:27</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="scanInfoSubject"></a>
                    <span class="name">
                            <span class="modifier">Public</span>
                        <span ><b>scanInfoSubject</b></span>
                        <a href="#scanInfoSubject"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="../classes/ScanInfo.html" target="_self" >BehaviorSubject&lt;ScanInfo&gt;</a></code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="32" class="link-to-prism">src/app/services/ble/connection/ble-connection.service.ts:32</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="sentEncryptionKeyAgain"></a>
                    <span class="name">
                            <span class="modifier">Private</span>
                        <span ><b>sentEncryptionKeyAgain</b></span>
                        <a href="#sentEncryptionKeyAgain"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/boolean" target="_blank" >boolean</a></code>

                    </td>
                </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in <a href="" data-line="29" class="link-to-prism">src/app/services/ble/connection/ble-connection.service.ts:29</a></div>
                        </td>
                    </tr>


        </tbody>
    </table>
    <table class="table table-sm table-bordered">
        <tbody>
            <tr>
                <td class="col-md-4">
                    <a name="miBand3"></a>
                    <span class="name">
                            <span class="modifier">Protected</span>
                            <span class="modifier">Readonly</span>
                        <span ><b>miBand3</b></span>
                        <a href="#miBand3"><span class="icon ion-ios-link"></span></a>
                    </span>
                </td>
            </tr>
                <tr>
                    <td class="col-md-4">
                        <i>Type : </i>        <code><a href="../classes/MiBand3.html" target="_self" >MiBand3</a></code>

                    </td>
                </tr>
                        <tr>
                            <td class="col-md-4">
                                <div class="io-line">Inherited from         <code><a href="../injectables/BleBaseService.html" target="_self" >BleBaseService</a></code>
</div>
                            </td>
                        </tr>
                    <tr>
                        <td class="col-md-4">
                                <div class="io-line">Defined in         <code><a href="../injectables/BleBaseService.html#source" target="_self" >BleBaseService:18</a></code>
</div>
                        </td>
                    </tr>


        </tbody>
    </table>
</section>

    </div>


    <div class="tab-pane fade  tab-source-code" id="c-source">
        <pre class="line-numbers compodoc-sourcecode"><code class="language-typescript">import * as crypto from &#x27;crypto-browserify&#x27;;
import { Injectable } from &#x27;@angular/core&#x27;;
import { AndroidGattTransportMode, BluetoothLE, DeviceInfo, OperationResult, ScanStatus } from &#x27;@ionic-native/bluetooth-le/ngx&#x27;;
import { Platform } from &#x27;@ionic/angular&#x27;;
import { BehaviorSubject, first, Observer, Subject } from &#x27;rxjs&#x27;;
import { Buffer } from &#x27;buffer&#x27;;
import { FirebaseAuthService } from &#x27;../../firebase/auth/firebase-auth.service&#x27;;
import { filter, timeout } from &#x27;rxjs/operators&#x27;;
import { PermissionService } from &#x27;../../permission/permission.service&#x27;;
import { Device } from &#x27;../../../shared/models/classes/Device&#x27;;
import { ConnectionInfo } from &#x27;../../../shared/models/classes/ConnectionInfo&#x27;;
import { ScanInfo } from &#x27;../../../shared/models/classes/ScanInfo&#x27;;
import { ScanResult } from &#x27;../../../shared/models/classes/ScanResult&#x27;;
import { LogHelper } from &#x27;../../../shared/models/classes/LogHelper&#x27;;
import { IDevice } from &#x27;../../../shared/models/interfaces/IDevice&#x27;;
import { BLEConnectionStatus, BLEScanStatus, BLEStatus, BLESubscriptionStatus } from &#x27;../../../shared/enums/ble.enum&#x27;;
import { User } from &#x27;@angular/fire/auth&#x27;;
import { FireTimestamp } from &#x27;../../../shared/models/classes/FireTimestamp&#x27;;
import { Characteristic } from &#x27;../../../shared/models/classes/Characteristic&#x27;;
import { Service } from &#x27;../../../shared/models/classes/Service&#x27;;
import { BleBaseService } from &#x27;../base/ble-base.service&#x27;;

@Injectable({
    providedIn: &#x27;root&#x27;
})
export class BleConnectionService extends BleBaseService {
    private readonly logHelper: LogHelper;
    private connectionInfo: ConnectionInfo;
    private sentEncryptionKeyAgain: boolean;
    public blStatusSubject: Subject&lt;string&gt;;
    public connectionInfoSubject: Subject&lt;ConnectionInfo&gt;;
    public scanInfoSubject: BehaviorSubject&lt;ScanInfo&gt;;
    public deviceSettingsSubject: BehaviorSubject&lt;Device&gt;;

    public constructor(
        ble: BluetoothLE,
        private platform: Platform,
        private authService: FirebaseAuthService,
        private permissionService: PermissionService
    ) {
        super(ble);
        this.platform.ready().then(() &#x3D;&gt; this.initializeBL());
        this.logHelper &#x3D; new LogHelper(BleConnectionService.name);
        this.sentEncryptionKeyAgain &#x3D; false;
        this.blStatusSubject &#x3D; new Subject&lt;string&gt;();
        this.deviceSettingsSubject &#x3D; new BehaviorSubject&lt;Device&gt;(new Device());
        this.connectionInfo &#x3D; new ConnectionInfo();
        this.connectionInfoSubject &#x3D; new BehaviorSubject&lt;ConnectionInfo&gt;(this.connectionInfo);
        this.scanInfoSubject &#x3D; new BehaviorSubject&lt;ScanInfo&gt;(new ScanInfo());
        this.connectionInfoSubject.subscribe(connectionInfo &#x3D;&gt; this.connectionInfo &#x3D; connectionInfo);
        this.authService.authUserSubject.subscribe(async (user: User | undefined) &#x3D;&gt; {
            // reset stats after user logout
            if (user &#x3D;&#x3D;&#x3D; undefined) {
                this.logHelper.logDefault(&#x27;authUserSubject&#x27;, &#x27;Resetting data after logout&#x27;);
                // disconnect device when user logs out
                if (this.connectionInfo.isConnected() &amp;&amp; this.connectionInfo.device) {
                    this.logHelper.logDefault(&#x27;authUserSubject&#x27;, &#x27;Disconnecting device after logout&#x27;);
                    await this.disconnectAndClose(this.connectionInfo.device);
                }
                this.scanInfoSubject.next(new ScanInfo());
                this.deviceSettingsSubject.next(new Device());
            }
        });
    }

    // request &#x3D; true / false (default) - Should user be prompted to enable Bluetooth
    //
    // statusReceiver &#x3D; true / false (default) - Should change in Bluetooth status notifications be sent.
    //
    // restoreKey &#x3D; A unique string to identify your app. Bluetooth Central background mode is required to use this,
    //              but background mode doesn&#x27;t seem to require specifying the restoreKey.
    private initializeBL(request &#x3D; false, statusReceiver &#x3D; true, restoreKey &#x3D; &#x27;miband3companion&#x27;): void {
        // init bluetooth and subscribe to bluetooth status changes
        this.ble.initialize({ request, statusReceiver, restoreKey }).subscribe({
            next: (data: { status: &#x27;enabled&#x27; | &#x27;disabled&#x27; }) &#x3D;&gt; {
                this.logHelper.logDefault(&#x27;initializeBL&#x27;, &#x27;Bluetooth status&#x27;, { value: data.status });
                this.blStatusSubject.next(data.status);
                // reset stats when bl get disabled
                if (data.status &#x3D;&#x3D;&#x3D; BLEStatus.DISABLED) {
                    this.logHelper.logDefault(&#x27;initializeBL&#x27;, &#x27;Resetting service data after disabling BL&#x27;);
                    this.scanInfoSubject.next(new ScanInfo());
                    this.connectionInfoSubject.next(new ConnectionInfo());
                }
            },
            error: (e: unknown) &#x3D;&gt; Promise.reject(this.logHelper.getUnknownMsg(e))
            /*{
                if (typeof e &#x3D;&#x3D;&#x3D; &#x27;string&#x27; || e instanceof Error) {
                    return Promise.reject(this.logHelper.getUnknownMsg(e));
                } else {
                    return Promise.reject(this.logHelper.getUnknownMsg((e as BLEError).message));
                }
                return Promise.reject(this.logHelper.getUnknownMsg(e));
            }*/
        });
        this.logHelper.logDefault(&#x27;initializeBL&#x27;, &#x27; Bluetooth has been initialized!&#x27;);
    }

    public async isConnected(deviceData: string | IDevice): Promise&lt;boolean&gt; {
        try {
            await this.blAndPermissionChecks();
            const wasConnected &#x3D; await this.wasConnected(deviceData);
            return wasConnected ? Promise.resolve(
                (await this.ble.isConnected({
                    address: typeof deviceData &#x3D;&#x3D;&#x3D; &#x27;string&#x27; ? deviceData : deviceData.macAddress
                })).isConnected
            ) : Promise.resolve(false);
        } catch (e: unknown) {
            return Promise.reject(this.logHelper.getUnknownMsg(e));
        }
    }

    public async wasConnected(deviceData: string | IDevice): Promise&lt;boolean&gt; {
        try {
            await this.blAndPermissionChecks();
            return (await this.ble.wasConnected({ address: typeof deviceData &#x3D;&#x3D;&#x3D; &#x27;string&#x27; ? deviceData : deviceData.macAddress })).wasConnected;
        } catch (e: unknown) {
            return Promise.reject(this.logHelper.getUnknownMsg(e));
        }
    }

    public async enableBL(maxWaitTime: number &#x3D; 5000): Promise&lt;boolean&gt; {
        try {
            this.logHelper.logDefault(this.enableBL.name, &#x27;startTime&#x27;, { value: new Date().toISOString() });
            let isBLEnabled &#x3D; await this.isBLEnabled();
            this.logHelper.logDefault(this.enableBL.name, &#x27;isEnabled&#x27;, { value: isBLEnabled });
            if (isBLEnabled) {
                return true;
            }
            this.blStatusSubject.next(BLEStatus.ENABLING);
            this.ble.enable();
            await this.createTimeoutForEnableBL(maxWaitTime); // wait for BL to initialize and/or for user interacting with BL dialog
            this.logHelper.logDefault(this.enableBL.name, &#x27;waitTime end&#x27;, { value: new Date().toISOString() });
            isBLEnabled &#x3D; await this.isBLEnabled();
            this.logHelper.logDefault(this.enableBL.name, &#x27;Is BL enabled after enabling&#x27;, { value: isBLEnabled });
            if (!isBLEnabled) {
                this.blStatusSubject.next(BLEStatus.DISABLED);
            }
            return Promise.resolve(isBLEnabled);
        } catch (e: unknown) {
            return Promise.reject(this.logHelper.getUnknownMsg(e));
        }
    }

    public createTimeoutForEnableBL(ms: number): Promise&lt;void&gt; {
        this.logHelper.logDefault(this.createTimeoutForEnableBL.name, &#x27;timeout start&#x27;, { value: new Date().toISOString() });
        return new Promise&lt;void&gt;(res &#x3D;&gt; setTimeout(() &#x3D;&gt; {
            this.logHelper.logDefault(this.createTimeoutForEnableBL.name, &#x27;timeout end&#x27;, { value: new Date().toISOString() });
            res();
        }, ms));
    }

    public async isBLEnabled(): Promise&lt;boolean&gt; {
        try {
            return Promise.resolve((await this.ble.isEnabled()).isEnabled);
        } catch (e: unknown) {
            this.logHelper.logError(this.isBLEnabled.name, e);
            return Promise.resolve(false);
        }
    }

    public async blAndPermissionChecks(): Promise&lt;void&gt; {
        try {
            await this.permissionService.checkForBluetoothScanPermissions();
            this.logHelper.logDefault(this.blAndPermissionChecks.name, &#x27;Checking Bluetooth status&#x27;);
            const isEnabled &#x3D; await this.enableBL();
            return isEnabled ? Promise.resolve() : Promise.reject(&#x27;BLUETOOTH_IS_DISABLED&#x27;);
        } catch (e: unknown) {
            return Promise.reject(this.logHelper.getUnknownMsg(e));
        }
    }

    // Android prevents applications from starting and stopping scans more than 5 times in 30 seconds
    // if it happens then BL scanning will be disabled for 30s
    // to prevent the abuse of scanning wait at least 7 seconds after each scan
    public async scanForDevices(scanTime: number &#x3D; 1000): Promise&lt;void&gt; {
        try {
            await this.blAndPermissionChecks();
        } catch (e: unknown) {
            this.scanInfoSubject.error(this.logHelper.getUnknownMsg(e));
            this.scanInfoSubject.next(new ScanInfo());
        }
        const scanResults: ScanResult[] &#x3D; [];
        this.scanInfoSubject.next(new ScanInfo(BLEScanStatus.SCANNING, true));
        this.ble.startScan({
            services: [],
            scanMode: this.ble.SCAN_MODE_LOW_LATENCY,
            matchMode: this.ble.MATCH_MODE_AGGRESSIVE,
            matchNum: this.ble.MATCH_NUM_MAX_ADVERTISEMENT,
            callbackType: this.ble.CALLBACK_TYPE_ALL_MATCHES,
        }).subscribe({
            next: (scanData: ScanStatus) &#x3D;&gt; {
                if (scanData.name?.toLowerCase().includes(this.miBand3.name.toLowerCase())) {
                    const res &#x3D; new ScanResult(scanData.address, scanData.name, scanData.rssi);
                    const resIndex &#x3D; scanResults.findIndex((s: ScanResult) &#x3D;&gt; s.address &#x3D;&#x3D;&#x3D; res.address);
                    if (resIndex &#x3D;&#x3D;&#x3D; -1) { // ignore duplicates
                        scanResults.push(res);
                    } else { // update rssi if device is already added
                        scanResults[resIndex].rssi &#x3D; res.rssi;
                    }
                }
            },
            error: (e: unknown) &#x3D;&gt; {
                this.scanInfoSubject.error(this.logHelper.getUnknownMsg(e));
                this.scanInfoSubject.next(new ScanInfo());
            }
        });

        // stop scanning
        try {
            const isScanning &#x3D; (await this.ble.isScanning()).isScanning;
            if (isScanning) {
                setTimeout(async () &#x3D;&gt; {
                    try {
                        await this.ble.stopScan();
                        scanResults.sort(ScanResult.getCompareFunction(&#x27;rssi&#x27;, &#x27;desc&#x27;));
                        this.scanInfoSubject.next(new ScanInfo(BLEScanStatus.FINISHED, true, scanResults));
                    } catch (e: unknown) {
                        this.scanInfoSubject.error(this.logHelper.getUnknownMsg(e));
                        this.scanInfoSubject.next(new ScanInfo());
                    }
                }, scanTime);
            }
        } catch (error: unknown) {
            this.scanInfoSubject.error(this.logHelper.getUnknownMsg(error));
            this.scanInfoSubject.next(new ScanInfo());
        }
    }

    // address &#x3D; The address/identifier provided by the scan&#x27;s return object
    //
    // autoConnect &#x3D; Automatically connect as soon as the remote device becomes available (Android)
    //
    // transport set to TRANSPORT_LE is the safest for ble (auto can cause issues)
    //
    // firstTime &#x3D; if true skip (2. auth step) sending encryption key during auth process
    public async connect(device: IDevice, autoConnect: boolean &#x3D; false): Promise&lt;void&gt; {
        try {
            await this.blAndPermissionChecks();
            const wasConnected &#x3D; await this.wasConnected(device);
            this.logHelper.logDefault(this.connect.name, &#x27;wasConnected&#x27;, { value: wasConnected.valueOf() });
            this.connectionInfoSubject.next(new ConnectionInfo(BLEConnectionStatus.CONNECTING, false, device));
            if (wasConnected.valueOf()) {
                await this.ble.close({ address: device.macAddress });
                this.ble.connect({
                    address: device.macAddress,
                    autoConnect,
                    transport: AndroidGattTransportMode.TRANSPORT_LE
                }).subscribe(this.getConnectObserver());
            } else {
                // scan is needed before connecting
                this.ble.startScan({
                    services: [],
                    scanMode: this.ble.SCAN_MODE_LOW_LATENCY,
                    matchMode: this.ble.MATCH_MODE_AGGRESSIVE,
                    matchNum: this.ble.MATCH_NUM_MAX_ADVERTISEMENT,
                    callbackType: this.ble.CALLBACK_TYPE_ALL_MATCHES,
                }).pipe(filter(s &#x3D;&gt; s.address &#x3D;&#x3D;&#x3D; device.macAddress), timeout(15000), first()).subscribe({
                    next: async () &#x3D;&gt; {
                        await this.ble.stopScan();
                        this.ble.connect({
                            address: device.macAddress,
                            autoConnect,
                            transport: AndroidGattTransportMode.TRANSPORT_LE
                        }).subscribe(this.getConnectObserver());
                    },
                    error: async (e: unknown) &#x3D;&gt; {
                        if (e instanceof Error &amp;&amp; e.message !&#x3D;&#x3D; &#x27;Timeout has occurred&#x27;) {
                            this.connectionInfoSubject.error(this.logHelper.getUnknownMsg(e));
                        }
                        const res &#x3D; await this.ble.isScanning();
                        if (res.isScanning) {
                           await this.ble.stopScan();
                        }
                        this.connectionInfoSubject.next(new ConnectionInfo());
                    }
                });
            }
        } catch (e: unknown) {
            this.connectionInfoSubject.error(this.logHelper.getUnknownMsg(e));
            this.connectionInfoSubject.next(new ConnectionInfo());
        }
    }

    private getConnectObserver(): Partial&lt;Observer&lt;DeviceInfo&gt;&gt; {
        return {
            next: async (connectionData: DeviceInfo): Promise&lt;void&gt; &#x3D;&gt; {
                try {
                    this.logHelper.logDefault(this.getConnectObserver.name, &#x27;connection info&#x27;, { value: connectionData });
                    const conInfo &#x3D; new ConnectionInfo(connectionData.status as BLEConnectionStatus);
                    if (connectionData.status &#x3D;&#x3D;&#x3D; BLEConnectionStatus.CONNECTED) {
                        this.logHelper.logDefault(this.getConnectObserver.name + &#x27;connection status&#x27;, &#x27;Connected to device!&#x27;);
                        await this.ble.discover({ address: connectionData.address, clearCache: false }); // discover services
                        conInfo.device &#x3D; new Device(this.miBand3.name, connectionData.address);
                        this.connectionInfoSubject.next(conInfo);
                        this.authenticateMiBand(conInfo.device); // start auth process
                    } else if (connectionData.status &#x3D;&#x3D;&#x3D; BLEConnectionStatus.DISCONNECTED) {
                        this.logHelper.logDefault(this.getConnectObserver.name + &#x27;connection status&#x27;, &#x27;Unexpectedly disconnected!&#x27;);
                        // free BL resource if auth failed and gets disconnected
                        try {
                            await this.ble.close({ address: connectionData.address });
                        } catch (e: unknown) {
                            this.logHelper.logError(this.getConnectObserver.name, e);
                        }
                        this.connectionInfoSubject.next(conInfo);
                    }
                } catch (e: unknown) {
                    this.connectionInfoSubject.error(this.logHelper.getUnknownMsg(e));
                    this.connectionInfoSubject.next(new ConnectionInfo());
                }
            },
            error: (e: unknown): void &#x3D;&gt; {
                this.connectionInfoSubject.error(this.logHelper.getUnknownMsg(e));
                this.connectionInfoSubject.next(new ConnectionInfo());
            }
        };
    }

    public async disconnectAndClose(deviceData: string | IDevice): Promise&lt;void&gt; {
        try {
            const address &#x3D; typeof deviceData &#x3D;&#x3D;&#x3D; &#x27;string&#x27; ? deviceData : deviceData.macAddress;
            await this.ble.disconnect({ address });
            await this.ble.close({ address });
            this.logHelper.logDefault(this.disconnectAndClose.name, &#x27;Disconnected successfully!&#x27;);
        } catch (e: unknown) {
            this.connectionInfoSubject.error(this.logHelper.getUnknownMsg(e));
        } finally {
            this.connectionInfoSubject.next(new ConnectionInfo());
        }
    }

    private authenticateMiBand(device: IDevice): void {
        const service &#x3D; this.miBand3.getServiceByName(&#x27;authentication&#x27;);
        const characteristic &#x3D; service?.getCharacteristicByName(&#x27;auth&#x27;);
        if (service &#x3D;&#x3D;&#x3D; undefined) {
            throw new Error(&#x27;Failed to get authentication service&#x27;);
        } else if (characteristic &#x3D;&#x3D;&#x3D; undefined) {
            throw new Error(&#x27;Failed to get authentication characteristic&#x27;);
        }
        // Authentication steps
        // 1. set notify on (by sending 2 bytes request (0x01, 0x00) to the Descriptor &#x3D;&#x3D;&#x3D; subscribe)
        this.subscribe(
            device,
            service,
            characteristic,
            {
                next: async (data: OperationResult) &#x3D;&gt; {
                    try {
                        if (this.connectionInfo.device !&#x3D;&#x3D; undefined) {
                            if (data.status &#x3D;&#x3D;&#x3D; BLESubscriptionStatus.SUBSCRIBED) {
                                this.logHelper.logDefault(this.authenticateMiBand.name, &#x27;Subscribed to auth&#x27;);
                                // authentication sub will fail immediately if the encryption key is same as on the Mi Band 3
                                // it is better to start with requesting a random key first
                                // if the device has different encryption/secret key &#x3D;&gt; 100304 &#x3D;&gt; send encryption key &#x3D;&gt; back to 100101
                                // 2. Request random key by sending 2 bytes: 0x02 + 0x00
                                await this.write(data.address, data.service, data.characteristic, Buffer.from([0x02, 0x00]));
                            } else {
                                if (data.value !&#x3D;&#x3D; undefined) {
                                    const response &#x3D; Buffer.from(this.ble.encodedStringToBytes(data.value)).subarray(0, 3).toString(&#x27;hex&#x27;); // get the first 3 bytes to know what to do
                                    this.logHelper.logDefault(this.authenticateMiBand.name, &#x27;auth response&#x27;, { value: response });
                                    switch (response) {
                                        case &#x27;100101&#x27;:
                                            // if user did press the button on the Mi Band
                                            // authentication level 1
                                            this.logHelper.logDefault(this.authenticateMiBand.name, &#x27;Sent key ok&#x27;);
                                            this.logHelper.logDefault(this.authenticateMiBand.name, &#x27;Paired successfully&#x27;);
                                            // 3. Request random key by sending 2 bytes: 0x02 + 0x00
                                            await this.write(data.address, data.service, data.characteristic, Buffer.from([0x02, 0x00]));
                                            this.logHelper.logDefault(this.authenticateMiBand.name, &#x27;Request sent for a random key&#x27;);
                                            break;
                                        case &#x27;100102&#x27;:
                                            this.connectionInfoSubject.error(&#x27;Pairing failed!\nPlease press the button on Mi Band to confirm pairing!&#x27;);
                                            this.connectionInfoSubject.next(new ConnectionInfo(BLEConnectionStatus.CONNECTED, false, device));
                                            await this.sendEncryptionKey(data.address, data.service, data.characteristic); // send encryption key again
                                            break;
                                        case &#x27;100104&#x27;:
                                            this.connectionInfoSubject.error(&#x27;Encryption key sending failed!&#x27;);
                                            // re-send encryption key once if sending failed
                                            if (!this.sentEncryptionKeyAgain) {
                                                this.connectionInfoSubject.next(new ConnectionInfo(BLEConnectionStatus.CONNECTED, false, device));
                                                await this.sendEncryptionKey(data.address, data.service, data.characteristic); // send encryption key again
                                                this.sentEncryptionKeyAgain &#x3D; true;
                                            } else {
                                                await this.disconnectAndClose(data.address);
                                            }
                                            break;
                                        case &#x27;100201&#x27;:
                                            // 4. Encrypt the random 16 bytes number with AES/ECB/NoPadding with the encryption key that was sent at 2. step
                                            // authentication level 2
                                            this.logHelper.logDefault(this.authenticateMiBand.name, &#x27;Requested random key received&#x27;);
                                            const randomData &#x3D; Buffer.from(this.ble.encodedStringToBytes(data.value)).subarray(3, 19); // remove the first 3 bytes
                                            const algorithm &#x3D; &#x27;aes-128-ecb&#x27;;
                                            const cipher &#x3D; crypto.createCipheriv(algorithm, this.getEncryptionKey(), &#x27;&#x27;).setAutoPadding(false); // create encryptor + disable auto padding
                                            const encryptedData &#x3D; cipher.update(randomData); // encrypt data
                                            cipher.final(); // stop cipher
                                            // 5. Send 2 bytes 0x03 + 0x00 + encrypted data
                                            await this.write(data.address, data.service, data.characteristic, Buffer.concat([Buffer.from([0x03, 0x00]), encryptedData]));
                                            break;
                                        case &#x27;100204&#x27;:
                                            // data request failed
                                            this.connectionInfoSubject.error(&#x27;Requesting data failed!&#x27;);
                                            await this.disconnectAndClose(data.address);
                                            break;
                                        case &#x27;100301&#x27;:
                                            // 6. Authentication done
                                            this.logHelper.logDefault(this.authenticateMiBand.name, &#x27;Authenticated successfully&#x27;);
                                            device.lastUsedDate &#x3D; FireTimestamp.now();
                                            this.connectionInfoSubject.next(new ConnectionInfo(BLEConnectionStatus.CONNECTED, true, device));
                                            await this.unsubscribe(data.address, data.service, data.characteristic);
                                            break;
                                        case &#x27;100304&#x27;:
                                            // encryption fails, because the device probably has a different secret key
                                            this.logHelper.logError(this.authenticateMiBand.name, &#x27;Encryption failed, sending new encryption key!&#x27;);
                                            await this.sendEncryptionKey(data.address, data.service, data.characteristic); // write 2 bytes (0x01 + 0x00)  + encryption key (16 bytes)
                                            break;
                                        default:
                                            this.logHelper.logError(this.authenticateMiBand.name, &#x27;Unexpected authentication response&#x27;, { value: response });
                                            await this.disconnectAndClose(data.address);
                                    }
                                }
                            }
                        } else {
                            this.logHelper.logError(this.authenticateMiBand.name, &#x27;no connected device to continue authentication process&#x27;);
                        }
                    } catch (error: unknown) {
                        this.connectionInfoSubject.error(this.logHelper.getUnknownMsg(error));
                        const isConnected &#x3D; await this.isConnected(data.address);
                        if (isConnected) {
                            await this.disconnectAndClose(data.address);
                        }
                    }
                },
                error: (e: unknown) &#x3D;&gt; {
                    this.logHelper.logError(this.authenticateMiBand.name, e);
                }
            }
        );
    }

    private async sendEncryptionKey(
        deviceData: string | IDevice,
        service: string | Service,
        characteristic: string | Characteristic
    ): Promise&lt;OperationResult&gt; {
        const writeData &#x3D; Buffer.concat([Buffer.from([0x01, 0x00]), this.getEncryptionKey()], 18); // 0x01 + 0x00 + encryption key &#x3D;&gt; 18 bytes
        return this.write(
            deviceData,
            service,
            characteristic,
            writeData
        );
    }

    public getEncryptionKey(): Buffer {
        return Buffer.from([0x30, 0x31, 0x32, 0x33, 0x34, 0x35, 0x36, 0x37, 0x38, 0x39, 0x40, 0x41, 0x42, 0x43, 0x44, 0x45]);
    }
}
</code></pre>
    </div>

</div>













                   </div><div class="search-results">
    <div class="has-results">
        <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
        <ul class="search-results-list"></ul>
    </div>
    <div class="no-results">
        <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
    </div>
</div>
</div>
               <!-- END CONTENT -->
           </div>
       </div>

          <label class="dark-mode-switch">
               <input type="checkbox">
               <span class="slider">
                    <svg class="slider-icon" viewBox="0 0 24 24" fill="none" height="20" stroke="#000" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" width="20" xmlns="http://www.w3.org/2000/svg">
                    <path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"></path>
                    </svg>
               </span>
          </label>

       <script>
            var COMPODOC_CURRENT_PAGE_DEPTH = 1;
            var COMPODOC_CURRENT_PAGE_CONTEXT = 'injectable';
            var COMPODOC_CURRENT_PAGE_URL = 'BleConnectionService.html';
            var MAX_SEARCH_RESULTS = 15;
       </script>

       <script src="../js/libs/custom-elements.min.js"></script>
       <script src="../js/libs/lit-html.js"></script>

       <script src="../js/menu-wc.js" defer></script>
       <script nomodule src="../js/menu-wc_es5.js" defer></script>

       <script src="../js/libs/bootstrap-native.js"></script>

       <script src="../js/libs/es6-shim.min.js"></script>
       <script src="../js/libs/EventDispatcher.js"></script>
       <script src="../js/libs/promise.min.js"></script>
       <script src="../js/libs/zepto.min.js"></script>

       <script src="../js/compodoc.js"></script>

       <script src="../js/tabs.js"></script>
       <script src="../js/menu.js"></script>
       <script src="../js/libs/clipboard.min.js"></script>
       <script src="../js/libs/prism.js"></script>
       <script src="../js/sourceCode.js"></script>
          <script src="../js/search/search.js"></script>
          <script src="../js/search/lunr.min.js"></script>
          <script src="../js/search/search-lunr.js"></script>
          <script src="../js/search/search_index.js"></script>
       <script src="../js/lazy-load-graphs.js"></script>


    </body>
</html>
